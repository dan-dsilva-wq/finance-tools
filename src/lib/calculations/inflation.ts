import { InflationInputs, InflationResults } from '@/types';

// Historical CPI data (base year varies by country, normalized for comparison)
// Sources: ONS (UK), BLS (US), StatCan (CA), ABS (AU)
// These are annual average CPI values

const cpiData: Record<string, Record<number, number>> = {
  gb: {
    1970: 9.5, 1971: 10.4, 1972: 11.1, 1973: 12.1, 1974: 14.1, 1975: 17.5,
    1976: 20.4, 1977: 23.7, 1978: 25.6, 1979: 29.1, 1980: 34.3, 1981: 38.4,
    1982: 41.7, 1983: 43.6, 1984: 45.8, 1985: 48.6, 1986: 50.3, 1987: 52.4,
    1988: 54.9, 1989: 59.2, 1990: 64.8, 1991: 68.6, 1992: 71.1, 1993: 72.2,
    1994: 74.0, 1995: 76.5, 1996: 78.4, 1997: 80.8, 1998: 83.0, 1999: 84.3,
    2000: 85.5, 2001: 86.7, 2002: 87.9, 2003: 89.2, 2004: 90.4, 2005: 92.2,
    2006: 94.5, 2007: 96.7, 2008: 100.0, 2009: 102.0, 2010: 105.4, 2011: 110.1,
    2012: 113.2, 2013: 116.1, 2014: 117.8, 2015: 118.0, 2016: 119.2, 2017: 122.4,
    2018: 125.4, 2019: 127.7, 2020: 128.8, 2021: 132.1, 2022: 144.0, 2023: 154.5,
    2024: 158.2, 2025: 162.0,
  },
  us: {
    1970: 38.8, 1971: 40.5, 1972: 41.8, 1973: 44.4, 1974: 49.3, 1975: 53.8,
    1976: 56.9, 1977: 60.6, 1978: 65.2, 1979: 72.6, 1980: 82.4, 1981: 90.9,
    1982: 96.5, 1983: 99.6, 1984: 103.9, 1985: 107.6, 1986: 109.6, 1987: 113.6,
    1988: 118.3, 1989: 124.0, 1990: 130.7, 1991: 136.2, 1992: 140.3, 1993: 144.5,
    1994: 148.2, 1995: 152.4, 1996: 156.9, 1997: 160.5, 1998: 163.0, 1999: 166.6,
    2000: 172.2, 2001: 177.1, 2002: 179.9, 2003: 184.0, 2004: 188.9, 2005: 195.3,
    2006: 201.6, 2007: 207.3, 2008: 215.3, 2009: 214.5, 2010: 218.1, 2011: 224.9,
    2012: 229.6, 2013: 233.0, 2014: 236.7, 2015: 237.0, 2016: 240.0, 2017: 245.1,
    2018: 251.1, 2019: 255.7, 2020: 258.8, 2021: 271.0, 2022: 292.7, 2023: 304.7,
    2024: 314.0, 2025: 320.0,
  },
  ca: {
    1970: 25.0, 1971: 25.7, 1972: 26.9, 1973: 28.9, 1974: 31.9, 1975: 35.4,
    1976: 38.0, 1977: 41.0, 1978: 44.7, 1979: 48.8, 1980: 53.7, 1981: 60.4,
    1982: 67.0, 1983: 70.9, 1984: 74.0, 1985: 77.0, 1986: 80.2, 1987: 83.7,
    1988: 87.1, 1989: 91.4, 1990: 95.8, 1991: 101.2, 1992: 102.7, 1993: 104.6,
    1994: 104.8, 1995: 107.0, 1996: 108.6, 1997: 110.4, 1998: 111.5, 1999: 113.4,
    2000: 116.5, 2001: 119.4, 2002: 122.1, 2003: 125.4, 2004: 127.7, 2005: 130.5,
    2006: 133.1, 2007: 136.0, 2008: 139.1, 2009: 139.4, 2010: 141.9, 2011: 145.9,
    2012: 148.1, 2013: 149.5, 2014: 152.4, 2015: 154.1, 2016: 156.3, 2017: 159.0,
    2018: 163.5, 2019: 166.8, 2020: 168.0, 2021: 173.6, 2022: 185.5, 2023: 192.8,
    2024: 198.0, 2025: 202.0,
  },
  au: {
    1970: 12.2, 1971: 12.9, 1972: 13.7, 1973: 14.9, 1974: 17.2, 1975: 19.8,
    1976: 22.5, 1977: 25.2, 1978: 27.2, 1979: 29.6, 1980: 32.6, 1981: 35.8,
    1982: 39.7, 1983: 43.7, 1984: 45.4, 1985: 48.3, 1986: 52.7, 1987: 57.2,
    1988: 61.3, 1989: 66.0, 1990: 71.0, 1991: 73.4, 1992: 74.1, 1993: 75.5,
    1994: 76.9, 1995: 80.5, 1996: 82.6, 1997: 82.6, 1998: 83.4, 1999: 84.6,
    2000: 87.9, 2001: 91.8, 2002: 94.6, 2003: 97.2, 2004: 99.5, 2005: 102.2,
    2006: 105.8, 2007: 108.3, 2008: 113.1, 2009: 115.1, 2010: 118.5, 2011: 122.5,
    2012: 124.7, 2013: 127.7, 2014: 131.0, 2015: 133.0, 2016: 134.7, 2017: 137.3,
    2018: 140.0, 2019: 142.3, 2020: 143.3, 2021: 148.0, 2022: 158.4, 2023: 167.5,
    2024: 173.0, 2025: 177.0,
  },
};

export function getAvailableYears(countryCode: string): number[] {
  const data = cpiData[countryCode.toLowerCase()];
  if (!data) return [];
  return Object.keys(data).map(Number).sort((a, b) => a - b);
}

export function getCpi(countryCode: string, year: number): number | null {
  const data = cpiData[countryCode.toLowerCase()];
  if (!data || !data[year]) return null;
  return data[year];
}

export function calculateInflation(
  inputs: InflationInputs,
  countryCode: string
): InflationResults | null {
  const { amount, fromYear, toYear } = inputs;

  const fromCpi = getCpi(countryCode, fromYear);
  const toCpi = getCpi(countryCode, toYear);

  if (fromCpi === null || toCpi === null) {
    return null;
  }

  const adjustedAmount = amount * (toCpi / fromCpi);
  const percentageChange = ((toCpi - fromCpi) / fromCpi) * 100;

  return {
    adjustedAmount: Math.round(adjustedAmount * 100) / 100,
    percentageChange: Math.round(percentageChange * 10) / 10,
    fromCpi,
    toCpi,
    fromYear,
    toYear,
  };
}

export function getLatestYear(countryCode: string): number {
  const years = getAvailableYears(countryCode);
  return years[years.length - 1] || 2024;
}

export function getEarliestYear(countryCode: string): number {
  const years = getAvailableYears(countryCode);
  return years[0] || 1970;
}
